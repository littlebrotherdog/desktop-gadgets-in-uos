# 2023操作系统功能挑战初赛报告文档

报告小组：弃子争先

成员：北方工业大学 耿飚

## 目标描述

我们小组的选题为 
**[proj175-desktop-gadgets-in-uos](https://github.com/oscomp/proj175-desktop-gadgets-in-uos)** 。

题目要求如下：<br>
1、使用qt+qml进行开发。<br>
2、默认提供天气，时钟，便签三个部件。<br>
3、部件相对大小为以下可能中的几种或全部1x1,1x2,1x4,2x2,2x4,3x4,4x4。<br>
4、支持拖拽预览区域的部件到常用区域，部件拖拽流畅且自然，无卡顿。<br>
5、支持部分小部件调整大小，调整后也应该为目标3中的尺寸中的一个。



## 比赛题目分析和相关资料调研
Qt是一个1991年由Qt Company开发的跨平台C++图形用户界面应用程序开发框架。它既可以开发GUI程序，也可用于开发非GUI程序，比如控制台工具和服务器。
Qt是面向对象的框架，使用特殊的代码生成扩展以及一些宏，Qt很容易扩展，并且允许真正地组件编程。  
2008年，Qt Company科技被诺基亚公司收购，Qt也因此成为诺基亚旗下的编程语言工具。2012年，Qt被Digia收购。  
2014年4月，跨平台集成开发环境Qt Creator 3.1.0正式发布，实现了对于iOS的完全支持，新增WinRT、Beautifier等插件，废弃了无Python接口的GDB调试支持，集成了基于Clang的C/C++代码模块，并对Android支持做出了调整，至此实现了全面支持iOS、Android、WP,它提供给应用程序开发者建立艺术级的图形用户界面所需的所有功能。
基本上，Qt 同 X Window 上的 Motif，Openwin，GTK 等图形界面库和 Windows 平台上的 MFC，OWL，VCL，ATL 是同类型的东西。  

## 开发计划

#### 第一步

受限于疫情影响，我们没办法拿到有 uintr 特性的物理机。为了方便后续工作开展，第一步我们将基于 qemu 实现支持 uintr 的模拟器。

预期产出：能在我们的 qemu 上跑 uintr-linux-kernel ，并正确通过 linux 实现的简单功能测例 uipi_sample.c 。

#### 第二步

进行性能测试，基于 Linux RFC 报告使用的 ipc-bench 作测试，比较 uintr 与 pipe等传统 IPC 方式的性能异同。

预期产出：复现 Linux RFC 的性能测试结果。

#### 第三步

自行编写 uintr+shmem 或其他运用 uintr 形式的用户测例，与传统 IPC 方式作比较。

预期产出：比 Linux RFC 更丰富的性能测试结果，验证 IPC 框架设计的可行性。

#### 第四步

修改 Linux 内核，为 IPC 框架提供更通用的系统调用接口，并通过测试。

预期产出：一个初步成型的原型系统。

#### 第五步

寻找能发挥我们系统优势的有意义应用场景，在调度、负载均衡等方面继续改进 IPC 框架和内核。

## 比赛过程中的重要进展

我们的项目进展可在主仓库的 `README.md` 中看到，其同时链接了我们得到相应进展时的工作记录文档或报告 ppt 。

在6月4日，我们基本完成了开发计划中前两步的内容，即完成了支持 uintr 的 qemu 的开发，并复现了 Linux RFC 的结果。

## 系统测试情况

### 第一步

用我们更改的 `qemu-uintr` （仓库地址：https://github.com/OS-F-4/qemu-uintr）运行 Linux 开发的使用 uintr 特性的内核 uintr-linux-kernel（仓库地址：https://github.com/intel/uintr-linux-kernel/），并用该内核运行功能测例 uipi_sample.c （位于 `uintr-linux-kernel/tools/uintr/sample/` 下），可看到运行成功，能看到输出了测例中输出的 `Success` ，并且可以正常返回到内核。


若希望复现该部分工作，可参考 `ppt/qemu-worklinglog.md` 中的”编译intel实现的linux内核“、“编译测试程序”、“编译qemu”几个部分。

### 第二步

用我们更改的 `qemu-uintr` 运行 Linux 开发的使用 uintr 特性的内核 uintr-linux-kernel，并用该内核运行 Linux RFC 报告（https://lore.kernel.org/lkml/20210913200132.3396598-1-sohil.mehta@intel.com/）使用的 ipc-bench 性能测试框架（仓库地址：https://github.com/intel/uintr-ipc-bench/tree/linux-rfc-v1/），对 RFC 报告提到的测试结果进行复现和验证。

RFC中测试结果：

<img src="C:\Users\QH\AppData\Roaming\Typora\typora-user-images\image-20220605194930002.png" alt="[[image]]-20220605194930002" style="zoom:50%;" />

RFC里限制传递消息大小为 $1$ ，比较 uintr 与传统 IPC 方式的延迟，说明其的有效性。

我们也能运行其框架并复现这一结果，以 uintr 与 pipe 的测试为例：


## 遇到的主要问题和解决方法

最大的问题是受限于疫情，无法获得有 uintr 硬件的物理机。因此我们必须将工作从自行开发功能环境（即 qemu-uintr）开始。

开发过程中，我们对 qemu 也不熟悉，很多地方不知如何动手。除了问及校内各位学长以外，还通过 qemu 官网提供的邮件列表，对社区成员进行了邮件询问，其中比较幸运有一位来着台湾的朋友，回复比较积极，也给我们提供了不少的帮助。

其他各种开发细节问题，可以查看我们仓库 `README/md` 以及 `ppt/` 下对应的文档来了解。遇到的每一个问题，我们都留下了解决过程的文档记录，如 `ppt/调度问题5-28.md` 、`ppt/debug-log-5-5.md` 等，都是我们开发中遇到的一些困难的思考和解决过程。

## 分工和协作

王之栋：前期调研，外部沟通，项目主导，qemu调试

项晨东：qemu开发

孙迅：qemu开发调试，性能测试

## 提交仓库目录和文件描述

我们提交的仓库是项目的主仓库，基本没有项目代码，项目代码通过链接的形式放在主仓库根目录的 `README.md` 中。当前，项目代码主要包括 `qemu-uintr` 。

仓库根目录的文件夹 `ppt/` 存放我们在项目进展过程产出的报告和文档，可配合 `README.md` 中的链接定位。

## 比赛收获

通过这次比赛，增进了知识，开阔了眼界，也收获了一段探索的经历，希望能进入决赛，继续完成后半段的探索。
